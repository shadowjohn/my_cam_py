import cv2
import numpy as np
#import pyautogui
import time
import tkinter as tk
from tkinter import messagebox
from tkinter import filedialog
import threading
import os
import webbrowser
import sounddevice as sd
import soundfile as sf
from moviepy.editor import VideoFileClip, AudioFileClip
from pydub import AudioSegment
import sys
import base64
import portalocker
import mss



VERSION = "0.01"

# 取得 exe 檔案的目錄路徑
pwd = os.path.dirname(os.path.realpath(sys.argv[0]));

lock_file = pwd + "\\lock.txt"

# 檢查是否存在鎖定檔案並創建文件鎖
# 防程式重複啟動
check_file_run = open(lock_file, "a+")
try:  
    portalocker.lock(check_file_run, portalocker.LOCK_EX | portalocker.LOCK_NB)
except:
    messagebox.showinfo("說明","程式已執行了...")
    sys.exit()


MESSAGE = f'''
桌面錄影小工具

版本: {VERSION}
作者: 羽山 (https://3wa.tw)  
    
''';
icon_b64 = "AAABAAEAWFgAAAEAIABIfQAAFgAAACgAAABYAAAAsAAAAAEAIAAAAAAAAHkAAMMOAADDDgAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v+Ow/5zUhf+c1IX/nNSF/6zbmf+/47D/6PXi/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+j14v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////4zNcf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of91wlT/rNuZ//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9nvUP/Z71D/33GXv+c1IX/td+k/9fuzf////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9uv0v/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+MzXH////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////X7s3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Z71D/33GXv+c1IX/td+k/9fuzf/////////////////////////////////////////////////////////////////////////////////////////////////////////////////X7s3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/7/jsP/////////////////////////////////////////////////X7s3/yui9////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////td+k/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Z71D/33GXv+c1IX/v+Ow/+j14v///////////////////////////////////////////4XKaP+Fymj/6PXi////////////////////////////nNSF/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+Fymj//////////////////////////////////////+j14v+U0Hv/X7k5/3XCVP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////5zUhf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/br9L/4XKaP+c1IX/v+Ow/////////////////7/jsP9fuTn/X7k5/2e9Q/+136T//////////////////////26/S/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe/////////////////////////////////8rovf91wlT/X7k5/1+5Of9fuTn/pNeO//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/dcJU/4zNcf9uv0v/X7k5/1+5Of9fuTn/X7k5/4zNcf/o9eL//////7XfpP99xl7/fcZe/33GXv99xl7/Z71D/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of///////////////////////////7XfpP9nvUP/X7k5/1+5Of9fuTn/X7k5/2e9Q//K6L3/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Z71D/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/br9L/7/jsP///////////////////////////7XfpP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn//////////////////////6zbmf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/br9L/+j14v//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6PXi/3XCVP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/lNB7//////////////////////+/47D/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/////////////////6zbmf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of91wlT/6PXi/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9fuzf+/47D/nNSF/4zNcf99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of91wlT/yui9////////////v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of///////////8rovf9nvUP/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Z71D/6zbmf/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////o9eL/dcJU/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/br9L/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+k147//////7/jsP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn//////+j14v9uv0v/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9nvUP/nNSF/+j14v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////33GXv9fuTn/X7k5/1+5Of9fuTn/X7k5/26/S/+c1IX/hcpo/26/S/9fuTn/X7k5/1+5Of9fuTn/X7k5/+j14v+c1IX/Z71D/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv+136T/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5//////+Fymj/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7/1+7N//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+Fymj/lNB7/7XfpP////////////////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7/////////////////6PXi/7/jsP+c1IX/jM1x/3XCVP///////////9fuzf99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+136T/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+c1IX/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////X7k5/1+5Of9fuTn/X7k5/4XKaP/X7s3/fcZe/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe/////////////////8rovf+k147/yui9/////////////////////////////////7XfpP9uv0v/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/26/S/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Z71D/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+s25n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1+5Of9fuTn/X7k5/1+5Of9fuTn/yui9/33GXv9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv+/47D/jM1x/2e9Q/9fuTn/X7k5/5TQe///////////////////////////////////////6PXi/5TQe/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+c1IX/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+s25n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7/jsP9fuTn/X7k5/1+5Of9fuTn/X7k5//////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7/yui9/1+5Of9fuTn/X7k5/1+5Of91wlT/////////////////////////////////////////////////yui9/3XCVP9fuTn/X7k5/1+5Of9uv0v/v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+s25n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+136T/X7k5/1+5Of9fuTn/X7k5/26/S///////fcZe/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe//////9nvUP/X7k5/1+5Of9fuTn/X7k5/9fuzf//////////////////////////////////////////////////////pNeO/2e9Q/9fuTn/pNeO/7/jsP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+MzXH/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////nNSF/1+5Of9fuTn/X7k5/1+5Of+Fymj//////33GXv9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv//////jM1x/1+5Of9fuTn/X7k5/1+5Of+k147//////////////////////////////////////7/jsP/o9eL////////////o9eL/hcpo/+j14v+/47D/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of91wlT/6PXi/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////4XKaP9fuTn/X7k5/1+5Of9fuTn/nNSF//////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7//////6TXjv9fuTn/X7k5/1+5Of9fuTn/fcZe/////////////////////////////////+j14v9nvUP/br9L/7/jsP//////////////////////v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/v+Ow/9fuzf+MzXH/lNB7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9nvUP/X7k5/1+5Of9fuTn/X7k5/7/jsP//////fcZe/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe///////K6L3/X7k5/1+5Of9fuTn/X7k5/1+5Of/o9eL///////////////////////////+c1IX/X7k5/1+5Of9fuTn/hcpo/+j14v///////////7/jsP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/hcpo/5zUhf9fuTn/X7k5/1+5Of+s25n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////X7s3/X7k5/1+5Of9fuTn/X7k5/1+5Of/o9eL//////33GXv9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv///////////1+5Of9fuTn/X7k5/1+5Of9fuTn/td+k///////////////////////o9eL/Z71D/1+5Of9fuTn/X7k5/1+5Of9nvUP/rNuZ//////+/47D/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/8rovf//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////rNuZ/1+5Of9fuTn/X7k5/1+5Of91wlT///////////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7///////////99xl7/X7k5/1+5Of9fuTn/X7k5/4zNcf//////////////////////hcpo/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/4zNcf//////v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/5TQe/9uv0v/X7k5/1+5Of9fuTn/X7k5/1+5Of9nvUP/6PXi/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////4zNcf9fuTn/X7k5/1+5Of9fuTn/lNB7////////////fcZe/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe////////////lNB7/1+5Of9fuTn/X7k5/1+5Of9uv0v/////////////////td+k/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of/X7s3//////7/jsP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of/o9eL/v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+136T/jM1x/26/S/9fuTn/X7k5/7XfpP///////////33GXv9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv///////////5zUhf9fuTn/X7k5/1+5Of9fuTn/br9L/9fuzf//////1+7N/2e9Q/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+c1IX///////////+/47D/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+MzXH///////////+U0Hv/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/nNSF////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1+7N/6zbmf/o9eL///////////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7///////////+/47D/dcJU/5TQe/+136T/6PXi////////////6PXi/3XCVP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of91wlT/////////////////v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/v+Ow////////////6PXi/2e9Q/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+136T/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////fcZe/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe/////////////////////////////////////////////////4XKaP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9nvUP/yui9/////////////////7/jsP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/br9L//////////////////////+s25n/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Z71D/9fuzf///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////33GXv9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv///////////////////////////////////////////+j14v+c1IX/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/td+k//////////////////////+/47D/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/5TQe////////////////////////////3XCVP9fuTn/X7k5/1+5Of9fuTn/X7k5/26/S/+/47D///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+c1IX/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv///////////9fuzf+Fymj/X7k5/1+5Of9fuTn/rNuZ////////////////////////////v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of/K6L3///////////////////////////+/47D/X7k5/1+5Of9fuTn/br9L/6zbmf//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////nNSF/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7//////////////////////7/jsP9uv0v/rNuZ/////////////////////////////////7/jsP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn//////////////////////////////////////33GXv99xl7/v+Ow/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////5zUhf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe//////////////////////////////////////////////////////////////////////+/47D/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5///////////////////////////////////////o9eL///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+c1IX/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv+/47D/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/jM1x/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/v+Ow////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////nNSF/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7/nNSF/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/5zUhf///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////5zUhf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe/5zUhf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+c1IX////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////X7s3/v+Ow/7/jsP+/47D/v+Ow/7/jsP+/47D/v+Ow/7/jsP91wlT/X7k5/1+5Of9fuTn/X7k5/1+5Of91wlT/v+Ow/7/jsP+/47D/v+Ow/7/jsP+/47D/v+Ow/8rovf+c1IX/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/nNSF////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////fcZe/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe////////////////////////////////////////////nNSF/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/5zUhf///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////33GXv9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv///////////////////////////////////////////5zUhf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+c1IX///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7///////////////////////////////////////////+/47D/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/26/S/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of91wlT/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/v+Ow////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////fcZe/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+c1IX/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////5zUhf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of///////////////////////////////////////////9fuzf+/47D/v+Ow/6zbmf//////////////////////////////////////////////////////pNeO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/26/S////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+j14v+c1IX/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn//////////////////////8rovf91wlT/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/6PXi/////////////////////////////////////////////////7/jsP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8rovf9nvUP/hcpo/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5///////////////////////o9eL/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/4zNcf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+c1IX/nNSF/5zUhf+MzXH/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/8rovf///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+j14v9uv0v/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of///////////////////////////3XCVP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+/47D///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn///////////////////////////+U0Hv/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/nNSF/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+j14v+MzXH/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5////////////////////////////td+k/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/5TQe/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////91wlT/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+136T/v+Ow/7/jsP+/47D/v+Ow/7/jsP+/47D/v+Ow/7/jsP+/47D/v+Ow/7/jsP+/47D/dcJU/2e9Q//o9eL//////////////////////+j14v9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v+Ow/2e9Q/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/dcJU/+j14v//////////////////////////////////////////////////////rNuZ/1+5Of9fuTn/dcJU////////////////////////////br9L/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/dcJU///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////K6L3/Z71D/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+MzXH/////////////////////////////////////////////////1+7N/2e9Q/9fuTn/X7k5/1+5Of+MzXH//////////////////////4zNcf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+Fymj/v+Ow/7/jsP+/47D/v+Ow/7/jsP+/47D/v+Ow/7/jsP+/47D/pNeO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8rovf9nvUP/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/6zbmf//////////////////////////////////////6PXi/3XCVP9fuTn/X7k5/1+5Of9fuTn/X7k5/6TXjv////////////////+k147/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe/////////////////////////////////////////////////7/jsP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/1+7N////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////yui9/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9nvUP/1+7N/////////////////////////////////4zNcf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/td+k////////////v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of//////////////////////////////////////////////////////X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/7/jsP////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s25n/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3XCVP///////////////////////////5zUhf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/4XKaP////////////////9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/yui9/////////////////////////////////////////////////1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+s25n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////5TQe/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/nNSF/////////////////6zbmf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2e9Q//o9eL/////////////////dcJU/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3XCVP99xl7/fcZe/33GXv99xl7/fcZe/33GXv99xl7/fcZe/33GXv9nvUP/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/nNSF////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////dcJU/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2e9Q//X7s3//////6zbmf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of/K6L3//////////////////////4zNcf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/4zNcf///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9fuzf9nvUP/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/fcZe/6zbmf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+s25n///////////////////////////+k147/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of99xl7/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////nNSF/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+s25n/////////////////////////////////v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/br9L//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9uv0v/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+s25n//////////////////////////////////////+j14v9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+s25n/////////////////////////////////////////////////Z71D/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/33GXv99xl7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+s25n//////////////////////////////////////////////////////33GXv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+c1IX//////////////////////////////////////////////////////8rovf/K6L3/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v+Ow/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2e9Q/+s25n///////////////////////////////////////////////////////////+U0Hv/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/hcpo//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////99xl7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2e9Q//K6L3/////////////////////////////////////////////////////////////////pNeO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3XCVP//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////rNuZ/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3XCVP/X7s3//////////////////////////////////////////////////////////////////////7/jsP9fuTn/X7k5/1+5Of9fuTn/fcZe/33GXv99xl7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+/47D/v+Ow/7/jsP+/47D/v+Ow/7/jsP/o9eL////////////////////////////////////////////////////////////////////////////o9eL/yui9////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";


output_path = pwd + "\\output"

if os.path.isdir(output_path) == False:
    # 建目錄
    os.mkdir(output_path)

video_file = output_path + "\\output.mp4"
audio_mic_file = output_path + "\\output_mic.wav"
audio_system_file = output_path + "\\output_system.wav"
output_file = output_path + "\\final_output.mp4"

# 錄製狀態
recording = False
out = None
record_area = None
x1, y1, x2, y2 = 0, 0, 0, 0

def select_area():
    global x1, y1, x2, y2, record_area
    record_area = tk.Toplevel()
    record_area.attributes("-fullscreen", True)
    record_area.attributes("-alpha", 0.3)
    record_area.configure(background='black')

    instruction = tk.Label(record_area, text="用滑鼠框選錄影範圍", bg="white")
    instruction.pack()

    canvas = tk.Canvas(record_area, cursor="cross")
    canvas.pack(fill="both", expand=True)       
    
    rect = None

    def on_button_press(event):
        global rect, x1, y1
        x1, y1 = event.x, event.y
        rect = canvas.create_rectangle(event.x, event.y, event.x, event.y, outline='red')

    def on_move_press(event):
        global rect, x1,y1, x2, y2        
        x2, y2 = event.x, event.y
        canvas.coords(rect, x1, y1, x2, y2)

    def on_button_release(event):
        record_area.grab_release()  # 釋放滑鼠事件
        record_area.destroy()

    canvas.bind("<ButtonPress-1>", on_button_press)
    canvas.bind("<B1-Motion>", on_move_press)
    canvas.bind("<ButtonRelease-1>", on_button_release)

    record_area.grab_set_global()  # 捕獲滑鼠事件

def start_recording():
    global output_path
    global fps_selected
    global video_file
    global audio_mic_file
    global audio_system_file
    global output_file
    global record_system_sound
    global record_mic_sound
    global out
    # Lock UI
    ui_enable_disable(False)
    
    t = str(int(time.time()))
    video_file = output_path + "\\" + t + "_tmp.mp4"
    audio_mic_file = output_path + "\\" + t + "_mic_tmp.wav"
    audio_system_file = output_path + "\\" + t + "_system_tmp.wav"
    output_file = output_path + "\\" + t + ".mp4"
    
    global x1, x2, y1, y2
    print("x1, y1: %s, %s" % (x1,y1))
    print("x2, y2: %s, %s" % (x2,y2))
    global recording, out, video_thread, audio_mic_thread, audio_system_thread
    if recording:
        messagebox.showwarning("警告", "錄影已經在進行中！")
        return
    if x1 == x2 or y1 == y2:
        messagebox.showwarning("警告", "請先選擇錄影範圍！")
        return
    recording = True       
    
    global fps_selected
    fps = int(fps_selected.get())
    print("fps: %s" % (fps))
    out = cv2.VideoWriter(video_file, cv2.VideoWriter_fourcc(*'mp4v'), fps, (x2-x1, y2-y1))
    
    video_thread = threading.Thread(target=record_video)
    
    # 看是否要錄聲音
    if record_system_sound.get() == True:
        audio_system_thread = threading.Thread(target=record_system_audio)
    if record_mic_sound.get() == True:
        audio_mic_thread = threading.Thread(target=record_mic_audio)
    video_thread.start()    
    if record_system_sound.get() == True:
        audio_system_thread.start()
    if record_mic_sound.get() == True:
        audio_mic_thread.start()
    start_button.config(state=tk.DISABLED)
    stop_button.config(state=tk.NORMAL)

def ui_enable_disable(bool_val):
    global checkbox_system_sound
    global checkbox_microphone
    global fps_menu
    if bool_val == True:
        checkbox_system_sound.config(state=tk.NORMAL)
        checkbox_microphone.config(state=tk.NORMAL)
        fps_menu.config(state=tk.NORMAL)
    else:
        checkbox_system_sound.config(state=tk.DISABLED)
        checkbox_microphone.config(state=tk.DISABLED)
        fps_menu.config(state=tk.DISABLED)

def record_video():
    global recording
    global x1, x2, y1, y2
    global video_file
    global out
    w = x2 - x1
    h = y2 - y1
    # 設置屏幕捕獲    
    with mss.mss() as sct:
        monitor = {"top": y1, "left": x1, "width": x2-x1, "height": y2-y1}
        while recording:
            #img = pyautogui.screenshot(region=(x1, y1, x2 - x1, y2 - y1))
            #frame = np.array(img)
            #frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
            #out.write(frame)
            #cv2.imshow("Recording", frame)
            #if cv2.waitKey(1) & 0xFF == ord('q'):
            #    break
            #ret, frame = screen.read()
            #if not ret:
            #    continue
            
            # 截取指定區域的圖像
            #frame = frame[y1:y2, x1:x2]
            frame = np.array(sct.grab(monitor))
            frame = cv2.cvtColor(frame, cv2.COLOR_BGRA2BGR)
            # 將幀寫入視頻
            out.write(frame)
    # 釋放資源
    
    out.release()
    cv2.destroyAllWindows()

def record_mic_audio():
    global audio_mic_file   
    global recording
    samplerate = 44100
    channels = 2    
    # 開啟音訊檔案準備寫入
    with sf.SoundFile(audio_mic_file, mode='x', samplerate=samplerate, channels=channels) as file:
        keywords = ["麥克風","USB PnP Sound Device","Realtek HD Audio Mic input"]
            
        # 查找第一組匹配的設備
        device_index, device_name = find_device_by_name(keywords)
        if device_index == None:
            device_index = 0
        with sd.InputStream(samplerate=samplerate, channels=channels, device=device_index) as stream:
            print('錄製麥克風聲音開始...')
            while recording:
                data, overflowed = stream.read(1024)
                file.write(data)
            print('錄製麥克風聲音結束.')
            
print(sd.query_devices())                
def record_system_audio():
    global audio_system_file
    global recording
    samplerate = 44100
    channels = 2

    # 開啟音訊檔案準備寫入
    with sf.SoundFile(audio_system_file, mode='x', samplerate=samplerate, channels=channels) as file_system:
        # 使用 OutputStream 寫入系統聲音
        # 要查找的關鍵字，包括中文和英文名稱的一部分        
        keywords = ["立體聲混音","Stereo Mix"]                   
            
        # 查找第一組匹配的設備
        device_index, device_name = find_device_by_name(keywords)
        if device_index == None:
            device_index = 0
        print("使用音源: %s" % (device_index))
        with sd.InputStream(samplerate=samplerate, channels=channels, device=device_index) as sys_stream:
            print('錄製系統聲音開始...')
            while recording:
                data, overflowed = sys_stream.read(1024)
                file_system.write(data)
            print('錄製系統聲音結束.')

def stop_recording():
    global recording
    global out
    global video_thread    
    global audio_system_thread
    global audio_mic_thread
    global record_system_sound
    global record_mic_sound
    
    if not recording:
        messagebox.showwarning("警告", "錄影未開始！")
        return
    recording = False
    ui_enable_disable(True)    
    if record_system_sound.get() == True:
        audio_system_thread.join()
    if record_mic_sound.get() == True:
        audio_mic_thread.join()
    # 影片最後才結束
    video_thread.join()    
    start_button.config(state=tk.NORMAL)
    stop_button.config(state=tk.DISABLED)
    messagebox.showinfo("提示", "錄影已停止")
    #time.sleep(3) # Wait 3sec
    merge_audio_video()
    
def find_device_by_name(keywords):
    devices = sd.query_devices()
    for idx, device in enumerate(devices):
        for keyword in keywords:
            if keyword in device['name']:
                return idx, device['name']
    return None, None  # 如果未找到匹配的設備，返回 None
def merge_audio_video():
    global audio_mic_file
    global audio_system_file
    global output_path
    global record_system_sound
    global record_mic_sound
    global pwd
    video_clip = VideoFileClip(video_file)
    
    tmp_merge_wav_file = pwd+"\\"+str(int(time.time()))+"_merge.wav"
    if record_system_sound.get() == True and record_mic_sound.get() == True:
        # from: https://stackoverflow.com/questions/59665469/pyaudio-how-to-capture-microphone-and-system-sounds-in-a-single-stream
        # 同時有二個聲音，合併
        speakersound = AudioSegment.from_file(audio_system_file)
        micsound = AudioSegment.from_file(audio_mic_file)
        mixsound = speakersound.overlay(micsound)        
        mixsound.export(tmp_merge_wav_file, format='wav')
                
        final_audio_clip = AudioFileClip(tmp_merge_wav_file)    
        # 將合併後的音訊剪輯添加到視訊剪輯中
        final_clip = video_clip.set_audio(final_audio_clip)        
        final_clip.write_videofile(output_file, codec='libx264', audio_codec='aac')
    elif record_system_sound.get() == True and record_mic_sound.get() == False:
        # 只有系統聲
        final_audio_clip = AudioFileClip(audio_system_file)            
        final_clip = video_clip.set_audio(final_audio_clip)        
        final_clip.write_videofile(output_file, codec='libx264', audio_codec='aac')
    elif record_system_sound.get() == False and record_mic_sound.get() == True:
        # 只有麥克風
        final_audio_clip = AudioFileClip(audio_mic_file)            
        final_clip = video_clip.set_audio(final_audio_clip)        
        final_clip.write_videofile(output_file, codec='libx264', audio_codec='aac')
    else:
        # 無聲音
        video_clip.write_videofile(output_file, codec='libx264')
        
    if os.path.isfile(video_file):
        try:
            os.remove(video_file)
        except:
            pass
    if os.path.isfile(audio_mic_file):
        try:
            os.remove(audio_mic_file)
        except:
            pass
    if os.path.isfile(audio_system_file):
        try:
            os.remove(audio_system_file)
        except:
            pass
    if os.path.isfile(tmp_merge_wav_file):
        try:
            os.remove(tmp_merge_wav_file)
        except:
            pass

def open_folder():
    folder_path = os.path.dirname(os.path.abspath(output_file))
    webbrowser.open(folder_path)

def on_message():    
    messagebox.showinfo("說明", MESSAGE)        

def on_closing():    
    if recording:
        if messagebox.askokcancel("離開", "錄影正在進行，確定要離開嗎？"):
            stop_recording()
            
            root.destroy()
    else:
        root.destroy()

# 函數：鼠標按下時的位置
def win_start_move(event):
        root.x = event.x
        root.y = event.y

def win_stop_move(event):
    root.x = None
    root.y = None

def win_do_move(event):
    deltax = event.x - root.x
    deltay = event.y - root.y
    x = root.winfo_x() + deltax
    y = root.winfo_y() + deltay
    root.geometry(f"+{x}+{y}")
root = tk.Tk()

# 將 base64 字符串解碼為二進制數據
binary_data = base64.b64decode(icon_b64)

# 釋放 ram
icon_b64 = None

# 將二進制數據寫入文件
with open(pwd+"\\tmp_icon.ico", "wb") as f:
    f.write(binary_data)
binary_data = None


# 設置窗口圖標
root.iconbitmap(pwd+"\\tmp_icon.ico")
if os.path.isfile(pwd+"\\tmp_icon.ico"):
    os.remove(pwd+"\\tmp_icon.ico")

# 計算窗口位置
screen_width = root.winfo_screenwidth()
screen_height = root.winfo_screenheight()
window_width = 450  # 假設窗口寬度為400
window_height = 80  # 假設窗口高度為 80

# 計算窗口位置: 右下角150px，距離底部20%
x = screen_width - window_width - 150
y = int(screen_height * 0.8)

# 設置窗口位置和大小
root.geometry(f"{window_width}x{window_height}+{x}+{y}")

# 設置窗口不可縮放
root.resizable(False, False)

root.title(f"我的桌面錄影 - V{VERSION} By 羽山秋人(https://3wa.tw)")

# 使用Frame將按鈕排成一行
button_frame = tk.Frame(root)
button_frame.pack(pady=10)

select_area_button = tk.Button(button_frame, text="選擇錄影範圍", command=select_area)
select_area_button.pack(side=tk.LEFT, padx=5)

start_button = tk.Button(button_frame, text="開始錄影", command=start_recording)
start_button.pack(side=tk.LEFT, padx=5)

stop_button = tk.Button(button_frame, text="停止錄影", command=stop_recording, state=tk.DISABLED)
stop_button.pack(side=tk.LEFT, padx=5)

open_folder_button = tk.Button(button_frame, text="打開錄影資料夾", command=open_folder)
open_folder_button.pack(side=tk.LEFT, padx=5)

info_button = tk.Button(button_frame, text="說明", command=on_message)
info_button.pack(side=tk.LEFT, padx=5)

exit_button = tk.Button(button_frame, text="離開程式", command=on_closing)
exit_button.pack(side=tk.LEFT, padx=5)

checkbox_frame = tk.Frame(root)
checkbox_frame.pack()

# 創建並佈局"錄系統聲音"的複選框，預設選擇
record_system_sound = tk.BooleanVar()
record_system_sound.set(True)  # 預設選擇
checkbox_system_sound = tk.Checkbutton(checkbox_frame, text="錄系統聲音", variable=record_system_sound)
checkbox_system_sound.pack(side=tk.LEFT, padx=5)

# 創建並佈局"錄麥克風"的複選框，預設不選中
record_mic_sound = tk.BooleanVar()
record_mic_sound.set(False)  # 預設不選
checkbox_microphone = tk.Checkbutton(checkbox_frame, text="錄麥克風", variable=record_mic_sound)
checkbox_microphone.pack(side=tk.LEFT, padx=5)

# 創建下拉選單的選項
fps_options = [15, 20, 25, 30, 60]
fps_selected = tk.IntVar()
fps_selected.set(25)  # 預設 25 fps

# 創建並布局下拉選單
fps_label = tk.Label(checkbox_frame, text="選擇 FPS：")
fps_label.pack(side=tk.LEFT, padx=5)
fps_menu = tk.OptionMenu(checkbox_frame, fps_selected, *fps_options)
fps_menu.pack(side=tk.LEFT, padx=5)

root.protocol("WM_DELETE_WINDOW", on_closing)

# 綁定標題欄的鼠標按下事件
root.bind("<ButtonPress-1>", win_start_move)
root.bind("<ButtonRelease-1>", win_stop_move)
root.bind("<B1-Motion>", win_do_move)

root.mainloop()